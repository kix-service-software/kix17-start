# --
# Modified version of the work: Copyright (C) 2006-2022 c.a.p.e. IT GmbH, https://www.cape-it.de
# based on the original work of:
# Copyright (C) 2001-2022 OTRS AG, https://otrs.com/
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file LICENSE for license information (AGPL). If you
# did not receive this file, see https://www.gnu.org/licenses/agpl.txt.
# --


[% RenderBlockStart("ArticleFilterDialog") %]
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
    $('#SetArticleFilter').on('click', function (Event) {
        Core.UI.Dialog.ShowContentDialog($('#ArticleFilterDialog'), [% Translate("Article filter") | JSON %], '20px', 'Center', true, [
            {
                Label: [% Translate("Apply") | JSON %],
                Function: function () {
                    var Data = Core.AJAX.SerializeForm($('#ArticleFilterDialogForm'));
                    Core.AJAX.FunctionCall(Core.Config.Get('CGIHandle'), Data, function () {
                        location.reload();
                    }, 'text');
                }
            },
            {
                Label: [% Translate("Reset") | JSON %],
                Function: function () {
                    $('#ArticleTypeFilter').val('').trigger('redraw.InputField');
                    $('#ArticleSenderTypeFilter').val('').trigger('redraw.InputField');
                    $('#ArticleSubject').val('').trigger('redraw.InputField');
                    $('#ArticleBody').val('').trigger('redraw.InputField');
[% RenderBlockStart("ArticleFilterDialogDynamicFieldReset") %]
                    $('#DynamicField_[% Data.Name | JSON %]_Active').attr('checked',false);
                    $('#DynamicField_[% Data.Name | JSON %]_Active').trigger('change');
[% RenderBlockEnd("ArticleFilterDialogDynamicFieldReset") %]
                }
            }
        ]);
        return false;
    });
    $('#ResetArticleFilter').on('click', function (Event) {
        var Data = {
            Action:       'AgentTicketZoomTabArticle',
            Subaction:    'ArticleFilterSet',
            TicketID:     "[% Data.TicketID | html %]",
            SaveDefaults: 1
        };
        Core.AJAX.FunctionCall(Core.Config.Get('CGIHandle'), Data, function () {
            location.reload();
        });
    });
[% RenderBlockStart("ArticleFilterDialogDynamicFieldActive") %]
    $('#DynamicField_[% Data.Name %]_Active').attr('checked',true);
[% RenderBlockEnd("ArticleFilterDialogDynamicFieldActive") %]
[% RenderBlockStart("ArticleFilterDialogDynamicFieldInactive") %]
    $('#DynamicField_[% Data.Name %]').prop('disabled',true);
[% RenderBlockEnd("ArticleFilterDialogDynamicFieldInactive") %]
//]]></script>
[% END %]
<div id="ArticleFilterDialog" class="Hidden">
    <form action="[% Env("CGIHandle") %]" method="post" id="ArticleFilterDialogForm" name="ArticleFilterDialogForm">
        <input type="hidden" value="AgentTicketZoomTabArticle" name="Action"/>
        <input type="hidden" value="ArticleFilterSet" name="Subaction"/>
        <input type="hidden" value="[% Data.TicketID | html %]" name="TicketID" id="TicketID" />
        <fieldset class="TableLike">
            <label for="ArticleTypeFilter">[% Translate("Article Type") | html %]:</label>
            <div class="Field">
                [% Data.ArticleTypeFilterString %]
            </div>
            <div class="Clear"></div>
            <label for="ArticleSenderTypeFilter">[% Translate("Sender Type") | html %]:</label>
            <div class="Field">
                [% Data.ArticleSenderTypeFilterString %]
            </div>
            <div class="Clear"></div>
            <label for="ArticleSubjectFilter">[% Translate("Article Subject") | html %]:</label>
            <div class="Field">
                <input type="text" id="ArticleSubject" name="ArticleSubjectFilter" value="[% Data.ArticleSubjectFilterString | html %]" />
            </div>
            <div class="Clear"></div>
            <label for="ArticleContentFilter">[% Translate("Article Body") | html %]:</label>
            <div class="Field">
                <input type="text" id="ArticleBody" name="ArticleBodyFilter" value="[% Data.ArticleBodyFilterString | html %]" />
            </div>
            <label for="ArticleContentFilter">[% Translate("MarkedAs") | html %]:</label>
            <div class="Field">
                [% Data.ArticleFlagFilterString %]
            </div>
            <label for="ArticleContentFilter">[% Translate("MarkedAs") | html %] ([% Translate("Text") | html %]):</label>
            <div class="Field">
                <input type="text" id="ArticleFlagText" name="ArticleFlagTextFilter" value="[% Data.ArticleFlagTextFilterString | html %]" />
                <br/>
                <span style="color:#929292">([% Translate("at first select relevant marks above") | html %])</span>
            </div>
[% RenderBlockStart("ArticleFilterDialogDynamicField") %]
            <div class="Clear"></div>
            <label for="DynamicField_[% Data.Name %]_Active">[% Translate("Filter") | html %] [% Translate(Data.Label) | html %]:</label>
            <div class="Field">
                <input type="checkbox" onchange="$('#DynamicField_[% Data.Name %]').prop('disabled', !$('#DynamicField_[% Data.Name %]_Active').prop('checked'));" id="DynamicField_[% Data.Name %]_Active" name="DynamicField_[% Data.Name %]_Active" value="1" />
            </div>
            <div class="Clear"></div>
            <label for="DynamicField_[% Data.Name %]">[% Data.Label | html %]:</label>
            <div class="Field">
                [% Data.Field | html %]
            </div>
[% RenderBlockEnd("ArticleFilterDialogDynamicField") %]
            <div class="Clear"></div>
            <label for="SaveDefaults">[% Translate("Save filter settings as default") | html %]:</label>
            <div class="Field">
                <input type="checkbox" id="SaveDefaults" name="SaveDefaults" value="1" />
            </div>
        </fieldset>
    </form>
</div>
[% RenderBlockEnd("ArticleFilterDialog") %]

[% RenderBlockStart("EventTypeFilterDialog") %]
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
    $('#SetArticleFilter').on('click', function (Event) {
        $('#EventTypeFilterDialog').find('form').css('width', '500px');
        Core.UI.Dialog.ShowContentDialog($('#EventTypeFilterDialog'), [% Translate("Event Type Filter") | JSON %], '20px', 'Center', true, [
            {
                Label: [% Translate("Apply") | JSON %],
                Function: function () {
                    var Data = Core.AJAX.SerializeForm($('#EventTypeFilterDialogForm'));
                    Core.AJAX.FunctionCall(Core.Config.Get('CGIHandle'), Data, function () {
                        location.reload();
                    }, 'text');
                }
            },
            {
                Label: [% Translate("Reset") | JSON %],
                Function: function () {
                    $('#EventTypeFilter').val('').trigger('redraw.InputField');
                }
            }
        ]);
        return false;
    });
    $('#ResetArticleFilter').on('click', function (Event) {
        var Data = {
            Action:       'AgentTicketZoomTabArticle',
            Subaction:    'EvenTypeFilterSet',
            TicketID:     "[% Data.TicketID | html %]",
            SaveDefaults: 1
        };
        Core.AJAX.FunctionCall(Core.Config.Get('CGIHandle'), Data, function () {
            location.reload();
        });
    });
//]]></script>
[% END %]
<div id="EventTypeFilterDialog" class="Hidden">
    <form action="[% Env("CGIHandle") %]" method="post" id="EventTypeFilterDialogForm" name="EventTypeFilterDialogForm">
        <input type="hidden" value="AgentTicketZoomTabArticle" name="Action"/>
        <input type="hidden" value="EvenTypeFilterSet" name="Subaction"/>
        <input type="hidden" value="[% Data.TicketID | html %]" name="TicketID"/>
        <fieldset class="TableLike">
            <label for="ArticleTypeFilter">[% Translate("Event Type") | html %]:</label>
            <div class="Field">
                [% Data.EventTypeFilterString %]
            </div>
            <div class="Clear"></div>
            <label for="SaveDefaults">[% Translate("Save as default") | html %]:</label>
            <div class="Field">
                <input type="checkbox" id="SaveDefaults" name="SaveDefaults" value="1" />
            </div>
        </fieldset>
    </form>
</div>
[% RenderBlockEnd("EventTypeFilterDialog") %]

[% RenderBlockStart("ArticleFlagDialog") %]
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
$(document.body).on('change', '.ArticleFlagSelection', function() {
    var $Element = $(this).find('option:selected');
    Core.KIX4OTRS.TicketZoomTabs.ArticleFlagAdd($Element,'[% Translate("Apply") | html %]','[% Translate("Set article flag") | html %]');
    // set width for use with Google Chrome
    $('.Dialog').css({"width":"530px"});
});
//]]></script>
[% END %]
<div id="ArticleFlagDialog" class="Hidden">
    <form action="[% Env("CGIHandle") %]" method="post" id="ArticleFlagDialogForm" name="ArticleFlagDialogForm">
        <input type="hidden" value="AgentTicketZoomTabArticle" name="Action"/>
        <input type="hidden" value="ArticleFlagSet" name="Subaction"/>
        <input type="hidden" value="[% Data.TicketID | html %]" name="TicketID"/>
        <input type="hidden" value="" name="ArticleID"/>
        <input type="hidden" value="" name="ArticleFlagKey"/>
        <fieldset class="TableLike">
            <label for="ArticleFlagSubject">[% Translate("Subject") | html %]:</label>
            <div class="Field">
                <input type="text" id="ArticleFlagSubject" name="ArticleFlagSubject" value="[% Data.ArticleFlagSubject | html %]" />
            </div>
            <div class="Clear"></div>
            <label for="ArticleFlagKeywords">[% Translate("Keywords") | html %]:</label>
            <div class="Field">
                <input type="text" id="ArticleFlagKeywords" name="ArticleFlagKeywords" value="[% Data.ArticleFlagKeywords | html %]" />
            </div>
            <div class="Clear"></div>
            <label for="ArticleFlagNote">[% Translate("Notes") | html %]:</label>
            <div class="Field">
                <textarea cols="40" rows="20" id="ArticleFlagNote" name="ArticleFlagNote">[% Data.ArticleFlagNote | html %]</textarea>
            </div>
        </fieldset>
    </form>
</div>
[% RenderBlockEnd("ArticleFlagDialog") %]

[% RenderBlockStart("Header") %]
        <div id="AgentTicketZoomTab">
            <div id="ArticleTree">
[% Data.ArticleTree %]
            </div>

[% RenderBlockStart("HintNoArticles") %]
            <div class="WidgetSimple">
                <div class="Content">
                    [% Translate("This item has no articles yet.") | html %]
                </div>
            </div>
[% RenderBlockEnd("HintNoArticles") %]

            <div id="ArticleItems">
[% Data.ArticleItems %]
            </div>
        </div>
        <div class="Clear"></div>
[% RenderBlockEnd("Header") %]

[% RenderBlockStart("Tree") %]
<div class="WidgetSimple">
    <div class="Header">
        <div class="WidgetAction Toggle" title="[% Translate("Show or hide the content.") | html %]" ></div>
        <h2><span>
            [% Translate("Article Overview") | html %] - [% Data.ArticleCount | html %] [% Translate("Article(s)") | html %]
        </span></h2>
        <div class="AdditionalInformation ControlRow">
            <div class="ResetColumnWidth Icons Hidden">
                <span class="InvisibleText">[% Translate("Reset Columns Width") | html %]:</span>
                <a id="ResetColumnWidth" href="#" title="[% Translate("Reset columns width") | html %]"><i class="fa fa-columns"></i><span>[% Translate("Reset columns width") | html %]</span></a>
            </div>
            <div class="ArticleTicketMarkAsRead Icons">
                <span class="InvisibleText">[% Translate("Mark") | html %]:</span>
                <a id="TicketMarkAsRead" href="#" title="[% Translate("Mark this ticket as read") | html %]"><i class="fa fa-eye"></i><span>[% Translate("Mark this ticket as read") | html %]</span></a>
            </div>
[% RenderBlockStart("ArticleFilterDialogLink") %]
            <div class="ArticleFilter Icons">
                <span class="InvisibleText">[% Translate("Article Filter") | html %]:</span>
                <a href="#" id="SetArticleFilter" title="[% Translate("Add Filter") | html %]"><i class="fa fa-filter"></i><span>[% Translate("Set") | html %]</span></a>
[% RenderBlockStart("ArticleFilterResetLink") %]
                <a href="#" id="ResetArticleFilter" title="[% Translate("Reset Filter") | html %]"><i class="fa fa-trash-o"></i><span>[% Translate("Reset") | html %]</span></a>
[% RenderBlockEnd("ArticleFilterResetLink") %]
            </div>
[% RenderBlockEnd("ArticleFilterDialogLink") %]
            <div class="ArticleView Icons">
                <span class="InvisibleText">[% Translate("Article") | html %] [% Translate("View") | html %]:</span>
[% RenderBlockStart("Expand") %]
                <a class="OneArticle Active" href="[% Env("Baselink") %]Action=AgentTicketZoom;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %];ZoomExpand=0;SelectedTab=[% Data.SelectedTab | uri %];StartHit=[% Data.StartHit | uri %];HasFilter=[% Data.HasFilter | uri %]" title="[% Translate("Show one article") | html %]"><i class="fa fa-minus"></i><span>[% Translate("Show one article") | html %]</span></a>
                <a class="AllArticles" href="[% Env("Baselink") %]Action=AgentTicketZoom;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %];ZoomExpand=1;SelectedTab=[% Data.SelectedTab | uri %];StartHit=[% Data.StartHit | uri %];HasFilter=[% Data.HasFilter | uri %]" title="[% Translate("Show all articles") | html %]"><i class="fa fa-bars"></i><span>[% Translate("Show all articles") | html %]</span></a>
[% RenderBlockEnd("Expand") %]
[% RenderBlockStart("Collapse") %]
                <a class="OneArticle" href="[% Env("Baselink") %]Action=AgentTicketZoom;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %];ZoomExpand=0;SelectedTab=[% Data.SelectedTab | uri %]" title="[% Translate("Show one article") | html %]"><i class="fa fa-minus"></i><span>[% Translate("Show one article") | html %]</span></a>
                <a class="AllArticles Active" href="[% Env("Baselink") %]Action=AgentTicketZoom;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %];ZoomExpand=1;SelectedTab=[% Data.SelectedTab | uri %]" title="[% Translate("Show all articles") | html %]"><i class="fa fa-bars"></i><span>[% Translate("Show all articles") | html %]</span></a>
[% RenderBlockEnd("Collapse") %]
            </div>
            <div class="Clear"></div>
        </div>
    </div>
    <div class="Content">
[% RenderBlockStart("ArticlePages") %]
        <div class="Pagination">
            <strong>[% Data.Result | html %]</strong> [% Translate("of") | html %] <strong>[% Data.TotalHits | html %]</strong> - [% Translate("Page") | html %]: [% Data.SiteNavBar %]
        </div>
        <div class="Clear"></div>
[% RenderBlockEnd("ArticlePages") %]
[% RenderBlockStart("ArticleList") %]
        <div class="TicketList">
            <div id="ArticleTableBody" class="ActionRow">
                <div class="Scroller">
                    <table id="ArticleTable" class="DataTable [% Data.TableClasses | html %]">
                        <thead>
                            <tr>
                                <th class="UnreadArticles">
                                    <a class="UnreadArticles" href="#" title="[% Translate("Unread articles") | html %]">
                                        <span class="UnreadArticles">
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                        </span>
                                    </a>
                                </th>
                                <th class="No Sortable"><a href="#">[% Translate("No.") | html %]</a></th>
                                <th class="SenderType Sortable"><a href="#">[% Translate("Sender") | html %]</a></th>
                                <th class="Type Sortable"><a href="#">[% Translate("Type") | html %]</a></th>
                                <th class="Direction Sortable"><a href="#" title="[% Translate("Direction") | html %]"><i class="fa fa-exchange"></i></a></th>
                                <th class="From Sortable"><a href="#">[% Translate("From") | html %]</a></th>
                                <th class="Subject Sortable"><a href="#">[% Translate("Subject") | html %]</a></th>
                                <th class="Created Sortable"><a href="#">[% Translate("Created") | html %]</a></th>
[% RenderBlockStart("TreeHeadDynamicField") %]
                                <th class="[% Data.Name | html %] Sortable"><a href="#">[% Translate(Data.Label) | html %]</a></th>
[% RenderBlockEnd("TreeHeadDynamicField") %]
                                <th class="Attachments Last">
                                    <a href="#" title="[% Translate("Attachments") | html %]">
                                        <i class="fa fa-paperclip"></i>
                                    </a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
[% RenderBlockStart("TreeItem") %]
                            <tr class="[% Data.SenderType | html %]-[% Data.ArticleType | html %] [% Data.ClassRow | html %]" id="Row[% Data.Count | uri %]">
                                <td class="[% Data.Class | html %] UnreadArticles Fixed NonTextContent">
[% RenderBlockStart("TreeItemImportantArticle") %]
                                    <span class="ImportantArticles" title="[% Translate("Important") | html %]">
                                        <i class="fa fa-info-circle"></i>
                                        <em>[% Translate("Important") | html %]</em>
                                    </span>
[% RenderBlockEnd("TreeItemImportantArticle") %]
[% RenderBlockStart("TreeItemNewArticle") %]
                                    <span class="[% Data.Class | html %]" title="[% Translate("Unread Article!") | html %]">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                    </span>
[% RenderBlockEnd("TreeItemNewArticle") %]
[% RenderBlockStart("TreeItemArticleFlagSet") %]
# show icon
                                    <span class="FlagIcon" id="ArticleFlag_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" style="[% Data.CSS | html %]">
                                         <i class="fa fa-[% Data.ArticleFlagIcon | html %]"></i>
                                    </span>
[% RenderBlockStart("TreeItemArticleFlagDialog") %]
# show edit / delete dialog (hidden)
                                    <div class="Hidden" id="ArticleFlagOptions_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" value="2">
                                        <div class="ArticleFlagOptionsDialog">
[% RenderBlockStart("TreeItemArticleFlagOptionShow") %]
                                            <a href="" class="ArticleFlag" title="[% Translate("show details for flag") | html %] [% Translate(Data.ArticleFlagValue) | html %]" rel="[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" data-action="show">[% Translate("show details") | html %]</a>
[% RenderBlockEnd("TreeItemArticleFlagOptionShow") %]
[% RenderBlockStart("TreeItemArticleFlagOptionEdit") %]
                                            <a href="" class="ArticleFlag" title="[% Translate("edit details for flag") | html %] [% Translate(Data.ArticleFlagValue) | html %]" rel="[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" data-action="show">[% Translate("show details / edit") | html %]</a>
[% RenderBlockEnd("TreeItemArticleFlagOptionEdit") %]
[% RenderBlockStart("TreeItemArticleFlagOptionDelete") %]
                                            <a href="" class="ArticleFlag" title="[% Translate("remove flag") | html %] [% Translate(Data.ArticleFlagValue) | html %]" rel="[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" data-action="delete">[% Translate("remove") | html %]</a>
[% RenderBlockEnd("TreeItemArticleFlagOptionDelete") %]
                                        </div>
                                    </div>
# edit dialog box
                                    <div id="ArticleFlagDialog_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" class="Hidden">
                                        <form action="[% Env("CGIHandle") %]" method="post" id="ArticleFlagDialog_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]_Form" name="ArticleFlagDialog_[% Data.ArticleFlagID | html %]_[% Data.ArticleFlagKey | html %]_Form">
                                            <input type="hidden" value="AgentTicketZoomTabArticle" name="Action"/>
                                            <input type="hidden" value="ArticleFlagUpdate" name="Subaction"/>
                                            <input type="hidden" value="[% Data.ArticleFlagKey | html %]" name="ArticleFlagKey"/>
                                            <input type="hidden" value="[% Data.TicketID | html %]" name="TicketID"/>
                                            <input type="hidden" value="[% Data.ArticleID | html %]" name="ArticleID"/>
                                            <fieldset class="TableLike">
                                                <label for="ArticleFlagSubject_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]">[% Translate("Subject") | html %]:</label>
                                                <div class="Field">
                                                    <input type="text" id="ArticleFlagSubject_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" name="ArticleFlagSubject" value="[% Data.ArticleFlagSubject | html %]"[% IF(!Data.AllowFlagEdit) %] readonly="readonly"[% END %] />
                                                </div>
                                                <div class="Clear"></div>
                                                <label for="ArticleFlagKeywords_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]">[% Translate("Keywords") | html %]:</label>
                                                <div class="Field">
                                                    <input type="text" id="ArticleFlagKeywords_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" name="ArticleFlagKeywords" value="[% Data.ArticleFlagKeywords | html %]"[% IF(!Data.AllowFlagEdit) %] readonly="readonly"[% END %] />
                                                </div>
                                                <div class="Clear"></div>
                                                <label for="ArticleFlagNote_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]">[% Translate("Notes") | html %]:</label>
                                                <div class="Field">
                                                    <textarea cols="40" rows="20" id="ArticleFlagNote_[% Data.ArticleID | html %]_[% Data.ArticleFlagKey | html %]" name="ArticleFlagNote"[% IF(!Data.AllowFlagEdit) %] readonly="readonly"[% END %]>[% Data.ArticleFlagNote | html %]</textarea>
                                                </div>
                                            </fieldset>
                                        </form>
                                    </div>
[% RenderBlockEnd("TreeItemArticleFlagDialog") %]

[% RenderBlockEnd("TreeItemArticleFlagSet") %]
[% RenderBlockStart("TreeItemNoNewArticle") %]
                                    <span class="NoContent"></span>
[% RenderBlockEnd("TreeItemNoNewArticle") %]
                                </td>
                                <td class="No">
                                    [% Data.Count | html %]
                                    <input type="hidden" class="ArticleInfo" name="Link[% Data.Count | uri %]" value="[% Env("Baselink") %]Action=AgentTicketZoomTabArticle;Subaction=ArticleUpdate;Count=[% Data.Count | uri %];TicketID=[% Data.TicketID | html %];ArticleID=[% Data.ArticleID | html %];"/>
                                    <input type="hidden" class="ArticleID" value="[% Data.ArticleID | html %]" />
                                    <input type="hidden" class="SortData" value="[% Data.Count | html %]" />
                                </td>
                                <td class="SenderType">
                                    <div>[% Translate(Data.SenderType) | html %]</div>
                                    <input type="hidden" class="SortData" value="[% Translate(Data.SenderType) | html %] &ndash; [% Translate(Data.ArticleType) | html %]" />
                                </td>
                                <td class="Type Center">
                                    <img src="[% Data.ArticleTypeIcon | html %]" title="[% Translate(Data.ArticleType) | html %]" alt="[% Translate(Data.ArticleType) | html %]">
                                    <input type="hidden" class="SortData" value="[% Translate(Data.ArticleType) | html %]" />
                                </td>
                                <td class="Direction Center">
                                    <img src="[% Data.DirectionIcon | html %]" title="[% Translate(Data.Direction) | html %]" alt="[% Translate(Data.Direction) | html %]">
                                    <input type="hidden" class="SortData" value="[% Data.Direction | html %]" />
                                 </td>
                                 <td class="From">
                                    <a href="#" title="[% Data.From | html %]">[% Data.FromRealname | html %]</a>
                                    <input type="hidden" class="SortData" value="[% Data.From | html %]" />
                                </td>
                                <td class="Subject">
                                    <a title="[% Data.Subject | html %]" href="#">[% Data.Subject | html %]</a>
                                    <input type="hidden" class="SortData" value="[% Data.Subject | html %]" />
                                </td>
                                <td class="Created">
                                    <a href="#">[% Data.Created | Localize("TimeShort") %]</a>
# Include custom sorting information: date in ISO format.
# Other date formats cannot be sorted reliably.
                                    <input type="hidden" class="SortData" value="[% Data.Created | html %]" />
                                </td>
[% RenderBlockStart("TreeItemDynamicField") %]
                                <td class="[% Data.Name %]">
                                    <a title="[% Data.Title | html %]" href="#">[% Data.Value | html %]</a>
                                    <input type="hidden" class="SortData" value="[% Data.Title | html %]" />
                                </td>
[% RenderBlockEnd("TreeItemDynamicField") %]
                                <td class="Attachments Attachment Fixed NonTextContent">
[% RenderBlockStart("TreeItemAttachment") %]
[% PROCESS ArticleAttachments.tt %]
[% RenderBlockEnd("TreeItemAttachment") %]
[% RenderBlockStart("TreeItemNoAttachment") %]
                                    <span class="NoContent"></span>
[% RenderBlockEnd("TreeItemNoAttachment") %]
                                </td>
                            </tr>
[% RenderBlockEnd("TreeItem") %]
[% RenderBlockStart("TreeNoItem") %]
                            <tr>
                                <td colspan="[% Data.Colspan %]">
                                    [% Translate("No articles were found with the defined filter.") %]
                                </td>
                            </tr>
[% RenderBlockEnd("TreeNoItem") %]
                        </tbody>
                    </table>
                </div>
                <div class="Handle ui-resizable-handle ui-resizable-s">
                    <a href="#">[% Translate("Resize") | html %]</a>
                </div>
            </div>
        </div>
[% RenderBlockEnd("ArticleList") %]
    </div>
</div>
[% RenderBlockEnd("Tree") %]

[% RenderBlockStart("ArticleItem") %]
<div>
    <a name="Article[% Data.ArticleID | html %]"></a>
    <div class="WidgetSimple Expanded [% Data.SenderType | html %]-[% Data.ArticleType | html %]">
        <div class="Header">
            <div class="WidgetAction Toggle" title="[% Translate("Show or hide the content.") | html %]" ></div>
            <h2><span>[% Translate("Article") | html %] #[% Data.Count | html %] &ndash; [% Data.Subject | html %]</span></h2>
            <div class="AdditionalInformation SpacingLoader">
                [% Translate("Created") | html %]: [% Data.Created | Localize("TimeShort") %]
[% RenderBlockStart("ArticleCreatedBy") %]
                [% Translate("by") | html %] [% Data.CreatedByUser | html %]
[% RenderBlockEnd("ArticleCreatedBy") %]
            </div>
        </div>
        <div class="Content">
[% PROCESS ArticleActionMenu.tt %]
            <div class="ArticleMailHeader">
                <fieldset class="TableLike FixedLabelSmall">
                    <label class="AdditionalInformationResponsive">[% Translate("Created") | html %]:</label>
                    <p class="Value AdditionalInformationResponsive">[% Data.Created | Localize("TimeShort") %]
[% RenderBlockStart("ArticleMailCreatedBy") %]
                        [% Translate("by") | html %] [% Data.CreatedByUser | html %]
[% RenderBlockEnd("ArticleMailCreatedBy") %]
                    </p>
                    <div class="Clear"></div>
[% RenderBlockStart("RowRecipient") %]
                    <label class="Switchable">[% Translate(Data.Key) | html %]:</label>
                    <p class="Value" title="[% Data.Value | html %]">
                        <span class="Switch [% Data.ValueHidden | html %]">[% Data.Value | html %]</span>
                        <span class="Switch [% Data.RealnameHidden | html %]">[% Data.Realname | html %]</span>
                    </p>
                    <div class="Clear"></div>
[% RenderBlockEnd("RowRecipient") %]
[% RenderBlockStart("RowData") %]
                    <label>[% Translate(Data.Key) | html %]:</label>
                    <p class="Value" title="[% Data.Value | html %]">[% Data.Value | html %]</p>
                    <div class="Clear"></div>
[% RenderBlockEnd("RowData") %]

# show article dynamic fields
[% RenderBlockStart("ArticleDynamicField") %]
                    <label>[% Translate(Data.Label) | html %]:</label>
[% RenderBlockStart("ArticleDynamicFieldLink") %]
                    <p class="Value" title="[% Data.Title %]">[% Data.HTMLLink %]</p>
[% RenderBlockEnd("ArticleDynamicFieldLink") %]
[% RenderBlockStart("ArticleDynamicFieldPlain") %]
                    <p class="Value" title="[% Data.Title %]">[% Data.Value %]</p>
[% RenderBlockEnd("ArticleDynamicFieldPlain") %]
                    <div class="Clear"></div>
[% RenderBlockEnd("ArticleDynamicField") %]

# show article options like signed, crypted, ...
[% RenderBlockStart("ArticleOption") %]
                    <label>[% Translate(Data.Key) | html %]:</label>
                    <div title="[% Data.Value | html %]" class="[% Data.Result | html %] Value">[% Translate(Data.Value) | html %]</div>
                    <div class="Clear"></div>
[% RenderBlockEnd("ArticleOption") %]

                    <label>[% Translate("Subject") | html %]:</label>
                    <p class="Value">[% Data.Subject | html %]</p>
                    <div class="Clear"></div>
[% RenderBlockStart("ArticleFlagOption") %]
                    <label>[% Translate("MarkedAs") | html %]:</label>
                    <p class="Value" title="[% Translate(Data.Note) | html %]">
                        <span class="FlagIcon" style="[% Data.CSS | html %]">
                            <i class="fa fa-[% Data.ArticleFlagIcon | html %]"></i>
                        </span> [% Translate(Data.Value) | html %][% IF(Data.Subject) %] - [% Translate("Subject") | html %]: [% Translate(Data.Subject) | html %][% END %]
                    </p>
                    <div class="Clear"></div>
[% RenderBlockEnd("ArticleFlagOption") %]

# show article accounted time
[% RenderBlockStart("ArticleAccountedTime") %]
                    <label>[% Translate(Data.Key) | html %]:</label>
                    <p class="Value">[% Data.Value | html %]</p>
                    <div class="Clear"></div>
[% RenderBlockEnd("ArticleAccountedTime") %]

# show attachments
[% RenderBlockStart("ArticleAttachment") %]
                    <label>[% Translate("Attachment") | html %]:</label>
                    <p class="Value">
[% RenderBlockStart("ArticleAttachmentRow") %]
[% RenderBlockStart("ArticleAttachmentRowLink") %]
                        <a class="[% Data.Class | html %]" href="[% Data.Link %]" [% Data.Target %] title="[% Translate(Data.Action) | html %]">[% Data.Filename | html %]</a> [% Data.DataFileSize | html %]
[% RenderBlockEnd("ArticleAttachmentRowLink") %]
[% RenderBlockStart("ArticleAttachmentRowNoLink") %]
                        [% Data.Filename | html %], [% Data.Filesize | html %]
[% RenderBlockEnd("ArticleAttachmentRowNoLink") %]
                        <br />
[% RenderBlockEnd("ArticleAttachmentRow") %]
                    </p>
                    <div class="Clear"></div>
[% RenderBlockEnd("ArticleAttachment") %]
                </fieldset>
            </div>
            <div class="ArticleMailContent[% IF Data.ArticleMetaData && Data.ArticleMetaData.size() %] WithMeta[% END %]">

[% RenderBlockStart("BodyPlain") %]
[% Data.BodyNote %]
                <div class="ArticleBody">
[% Data.Body %]
                </div>
[% RenderBlockEnd("BodyPlain") %]
[% RenderBlockStart("BodyHTML") %]
                <div class="ArticleMailContentHTMLWrapper">
[% RenderBlockStart("BrowserLinkMessage") %]
# Show info, that links within the iframe must be clicked with strg/cmd/shift (depending on the used browser and os)
# to open the links in a new window without the security permissions given to the iframe
                    <div class="MessageBrowser">
                        <p>
                            [% Translate("To open links in the following article, you might need to press Ctrl or Cmd or Shift key while clicking the link (depending on your browser and OS).") | html %]
                        </p>
                        <a class="Close" title="[% Translate("Close this message") | html %]" href="#"><i class="fa fa-times"></i></a>
                    </div>
[% RenderBlockEnd("BrowserLinkMessage") %]
# execute IFrame JS asynchronously. Otherwise it could happen before our API was loaded
# the following JS code must be within the template, otherwise it could happen, that also this code itself is not loaded yet
<script>
function CheckIFrameHeight(IFrameID) {
    if (typeof Core === 'object' && typeof Core.Agent === 'object' && typeof Core.Agent.TicketZoom === 'object') {
        Core.Agent.TicketZoom.IframeAutoHeight($('#' + IFrameID));
    }
    else {
        window.setTimeout(function () {
            CheckIFrameHeight(IFrameID);
        }, 500);
    }
}
</script>

# Use the HTML5 sandbox attribute to prevent plugins and scripts from being executed in the browser.
# Use IE's (non-standard) security attribute to achieve something similar in older IE browsers. Append session info to URL because IE will not send cookies.
# Set 'allow-popups' to allow IE10+ to open links. ref: http://www.w3.org/html/wg/wiki/ChangeProposals/sandbox_allow_popups
                    <iframe sandbox="allow-same-origin allow-popups ms-allow-popups allow-popups-to-escape-sandbox" width="100%" frameborder="0" id="Iframe[% Data.ArticleID | html %]" onload="window.setTimeout( function (){ CheckIFrameHeight('Iframe[% Data.ArticleID | html %]'); }, 500);" src="[% Env("Baselink") %]Action=AgentTicketAttachment;Subaction=HTMLView;ArticleID=[% Data.ArticleID | html %];FileID=[% Data.AttachmentIDOfHTMLBody | html %][% Data.Session | html %]"></iframe>
                    <script type="text/javascript">
                    // workaround for firefox, which seems to cache the src attribute of iframes sometimes which leads to
                    // the wrong iframe content being displayed (see https://bugzilla.mozilla.org/show_bug.cgi?id=356558)
                    document.getElementById('Iframe[% Data.ArticleID | html %]').contentWindow.location.href = document.getElementById('Iframe[% Data.ArticleID | html %]').src
                    </script>
                </div>
[% RenderBlockEnd("BodyHTML") %]
            [% IF Data.ArticleMetaData && Data.ArticleMetaData.size() %]
                <div class="ArticleMeta">
                [% FOREACH Entry IN Data.ArticleMetaData %]
                     <h2><span>[% Entry.Name | html %]</span></h2>
                    <ul>
                    [% FOREACH Item IN Entry.Matches %]
                        <li><a href="[% Item.URL | html %]"[% IF Item.URLPreview %] data-trigger="floater" data-floater-url="[% Item.URLPreview | html %]"[% END %] target="[% Item.Target | html %]">[% Item.Text | truncate(100) | html %]</a></li>
                    [% END %]
                    </ul>
                [% END %]
                </div>
            [% END %]
            </div>
        </div>
    </div>
</div>
[% RenderBlockStart("ArticleItemMarkAsSeen") %]
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
    Core.KIX4OTRS.TicketZoomTabs.MarkAsSeen([% Data.TicketID | html %], [% Data.ArticleID | html %]);
//]]></script>
[% END %]
[% RenderBlockEnd("ArticleItemMarkAsSeen") %]
[% RenderBlockEnd("ArticleItem") %]

[% RenderBlockStart("TicketItemMarkAsSeen") %]
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
    Core.KIX4OTRS.TicketZoomTabs.MarkTicketAsSeen([% Data.TicketID | html %]);
//]]></script>
[% END %]
[% RenderBlockEnd("TicketItemMarkAsSeen") %]
[% RenderBlockStart("TicketZoomInit") %]

[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
    Core.Config.Set('UserArticleTableColumnResizing', '[% Data.ColumnResizing %]');
    Core.KIX4OTRS.TicketZoomTabs.SetArticleFlagColumnWidth();
[% RenderBlockStart("ArticleFlagsWithoutEdit") %]
    Core.Config.Set('ArticleFlagsWithoutEdit::[% Data.FlagKey | html %]', '1');
[% RenderBlockEnd("ArticleFlagsWithoutEdit") %]
    Core.KIX4OTRS.TicketZoomTabs.ShowArticleFlagOptionsDialog('[% Translate("Article Flag Options") | html %]');
    Core.KIX4OTRS.TicketZoomTabs.ArticleFlagOptions([% Data.TicketID | html %],'[% Translate("Apply") | html %]','[% Translate("Set article flag") | html %]','[% Translate("for Article") | html %]');
    Core.KIX4OTRS.TicketZoomTabs.PopUpInit();
    Core.Agent.TicketZoom.Init({ ArticleTableHeight: parseInt('[% Env("UserTicketZoomArticleTableHeight") %]',10)},'AgentTicketZoomTabArticle');
    Core.Config.Set('Ticket::Frontend::HTMLArticleHeightDefault', parseInt("[% Config("Ticket::Frontend::HTMLArticleHeightDefault") %]" || 0, 10));
    Core.Config.Set('Ticket::Frontend::HTMLArticleHeightMax', parseInt("[% Config("Ticket::Frontend::HTMLArticleHeightMax") %]" || 0, 10));
    Core.Config.Set('Language.AttachmentViewMessage', [% Translate('Article could not be opened! Perhaps it is on another article page?') | JSON %]);

    if (typeof Core.UI.Floater !== 'undefined') {
        Core.UI.Floater.Init();
    }

    $('#TicketMarkAsRead').on('click', function(Event) {
        Core.KIX4OTRS.TicketZoomTabs.MarkTicketAsSeen([% Data.TicketID | html %],0);
        return false;
    });
//]]></script>
[% END %]
[% RenderBlockEnd("TicketZoomInit") %]

<div class="MetaFloater Hidden">
    <a href="#" class="Scale" title="[% Translate('Scale preview content') | html %]" style="display: none;">
        <i class="fa fa-search-plus"></i>
    </a>
    <a href="#" class="Open" target="_blank" title="[% Translate('Open URL in new tab') | html %]" style="display: none;">
        <i class="fa fa-external-link"></i>
    </a>
    <a href="#" class="Close" title="[% Translate('Close preview') | html %]">
        <i class="fa fa-times"></i>
    </a>
    <i class="fa fa-spinner fa-spin"></i>
    <div class="NoPreview">
        <i class="fa fa-warning"></i>
        [% Translate("A preview of this website can't be provided because it didn't allow to be embedded.") | html %]
    </div>
    <div class="Content" style="display: none;">
        <iframe sandbox="allow-scripts allow-forms"></iframe>
    </div>
</div>
