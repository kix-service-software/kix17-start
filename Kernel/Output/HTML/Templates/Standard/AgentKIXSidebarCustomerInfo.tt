# --
# Copyright (C) 2006-2023 KIX Service Software GmbH, https://www.kixdesk.com
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file LICENSE for license information (AGPL). If you
# did not receive this file, see https://www.gnu.org/licenses/agpl.txt.
# --


<div id="CustomerInfo" class="WidgetSimple CanDrag">
    <div class="Header">
        <div class="WidgetAction Toggle" title="[% Translate("Show or hide the content.") | html %]" id="KIXSidebarCustomerInfoBlockOpen" aria-controls="Core_UI_AutogeneratedID_0" aria-expanded="false"></div>
        <h2><span>[% Translate(Data.Title) | html %]</span></h2>
    </div>
[% RenderBlockStart("CustomerEmailSelection") %]
    <div class="KIXSidebarCustomerEmailSelection">
        [% Data.CustomerEmailSelection %]
    </div>
[% RenderBlockEnd("CustomerEmailSelection") %]
    <div class="Content">
        <span class="CustomerDetailsMagnifier">
[% RenderBlockStart("CustomerDetailsMagnifier") %]
            <i class="fa fa-search"></i>
[% RenderBlockEnd("CustomerDetailsMagnifier") %]
        </span>
        [% Data.CustomerTable %]
    </div>
    <div class="WidgetPopup" id="CustomerDetails[% Data.UserLogin | html %]">
        <div class="Header"> <h2><span>[% Translate("Contact Information") | html %]</span></h2></div>
        <div class="Content">
            <div class="Spacing">
[% RenderBlockStart("CustomerDetails") %]
                [% Data.CustomerDetailsTable %]
[% RenderBlockEnd("CustomerDetails") %]
            </div>
        </div>
    </div>
</div>
[% WRAPPER JSOnDocumentComplete %]
<script type="text/javascript">//<![CDATA[
if ( '[% Env("Action") %]' == 'AgentTicketZoom' ) {

    Core.KIX4OTRS.KIXSidebarCustomerInfo.UpdateContactSelection(Core.Config.Get('CGIHandle') + '?[% Config("SessionName") | uri %]=' + Core.App.GetSessionInformation().[% Config("SessionName") | uri %]+';','[% Data.TicketID %]','[% Data.ArticleID %]','', '');

    $(document).on('change','#CustomerUserEmail',function(){
        // open widget if it's closed
        if ($('#KIXSidebarCustomerInfoBlockOpen').attr('aria-expanded') == 'false')
            $('#KIXSidebarCustomerInfoBlockOpen').click();

        var CustomerID = $(this).val(),
            Type       = $(this).find(':selected').data('type');
        Core.Agent.CustomerSearch.ReloadCustomerInfo(CustomerID,'AgentKIXSidebarCustomerInfo',Type);
        Core.KIX4OTRS.KIXSidebarCustomerInfo.UpdateContactSelection(Core.Config.Get('CGIHandle') + '?[% Config("SessionName") | uri %]=' + Core.App.GetSessionInformation().[% Config("SessionName") | uri %]+';','[% Data.TicketID %]','[% Data.ArticleID %]',CustomerID, Type);
    });
}
//]]>
</script>
[% END %]